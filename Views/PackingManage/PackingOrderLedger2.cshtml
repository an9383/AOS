@using System.Data
@using HACCP.Libs
@using HACCP.Libs.Views

@{
    Layout = null;
    ViewBag.Title = "PackingOrderLedger2";

    var PackingOrders = @Html.Raw(Json.Encode(ViewBag.PackingOrders.Data));
    var Items = @Html.Raw(Json.Encode(ViewBag.Items.Data));
    var employeePopupData = @Html.Raw(Json.Encode(ViewBag.employeePopupData.Data));
    var PackingOrderLedger2Auth = @Html.Raw(Json.Encode(ViewBag.PackingOrderLedger2Auth.Data));
}
@{
    var tabs = new[] {
        new { id = 1, text = "포장지시대장작성" },
        new { id = 2, text = "전자서명"}
    };
}

@*포장지시 대장 작성*@

<script id="PackingOrderLedger2Js">

    var _PackingOrderLedger2TabNum = '1';
    var _PackingOrderLedger2SignCnt = 0;
    var _packingOrderLedgerCellClickEvent;
    var _PackingOrderLedger2IsEditable = false;
    var _PackingOrderLedger2Changes = new Array();
    var _PackingOrderLedger2ID = "";
    var _PackingOrderLedger2SignGubun = "";
    var _PackingOrderLedger2CRUDGubun = "";
    var _PackingOrderLedger2SignData;
    var _isOK = true;
    var _PackingOrderLedger2IsValid = false;
    var PackingOrderLedger2_lunch = 12;
    var PackingOrderLedger2_dinner = 18;

    $(function () {

        var ds = @Items;

        var columns = [
            { dataField: "item_cd", caption: "품목코드" },
            { dataField: "item_nm", caption: "품목명" }
        ];

        createPopup("PackingOrderLedger2Item", "품목조회", ds, columns);

        $("input.datetime_mask").mask('0000/00/00 00:00', { placeholder: "____/__/__ 00:00" });

        setDatePicker("#PackingOrderLedger2 .datepicker");

        var PackingOrderLedger2Auth = JSON.parse(@PackingOrderLedger2Auth)[0];

        if (PackingOrderLedger2Auth.form_query != "Y") {
            $("#PackingOrderLedger2Search").remove();
        }
        if (PackingOrderLedger2Auth.form_insert != "Y") {
            $("#PackingOrderLedger2Input").remove();
        }
        if (PackingOrderLedger2Auth.form_edit != "Y") {
            $("#PackingOrderLedger2Edit").remove();
        }
        if (PackingOrderLedger2Auth.form_delete != "Y") {
            $("#PackingOrderLedger2Delete").remove();
        }

        var PackingOrders = @PackingOrders;

        if (PackingOrders.length > 0) {
            $("#PackingOrderLedger2Grid_1").dxDataGrid("option", "dataSource", JSON.parse(@PackingOrders));
        }

        PackingOrderLedger2Editing(false);

    });


    // 수정중인지 체크
    function PackingOrderLedger2Editing(isEditing) {

        // 수정중일때
        if (isEditing) {
            $("#PackingOrderLedger2Search").dxButton().parent().parent().addClass("display-none");//조회 숨김
            $("#PackingOrderLedger2Delete").dxButton().parent().parent().addClass("display-none");//삭제 숨김
            $("#PackingOrderLedger2Input").dxButton().parent().parent().addClass("display-none");//입력 숨김
            $("#PackingOrderLedger2Edit").dxButton().parent().parent().addClass("display-none");//수정 숨김

            $("#PackingOrderLedger2Save").dxButton().parent().parent().removeClass("display-none");//저장 보이기
            $("#PackingOrderLedger2Undo").dxButton().parent().parent().removeClass("display-none");//취소 보이기

            $("#PackingOrderLedger2Form :disabled").prop('disabled', false);
            $("#PackingOrderLedger2Grid_1").dxDataGrid("option", "disabled", true);
            //$("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "disabled", false);
            //$("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("option", "disabled", true);

        } else {
            $("#PackingOrderLedger2Search").dxButton().parent().parent().removeClass("display-none");//조회 보이기
            $("#PackingOrderLedger2Delete").dxButton().parent().parent().removeClass("display-none");//삭제 보이기
            $("#PackingOrderLedger2Input").dxButton().parent().parent().removeClass("display-none");//입력 보이기
            $("#PackingOrderLedger2Edit").dxButton().parent().parent().removeClass("display-none");//수정 보이기

            $("#PackingOrderLedger2Save").dxButton().parent().parent().addClass("display-none");//저장 숨기기
            $("#PackingOrderLedger2Undo").dxButton().parent().parent().addClass("display-none");//취소 숨기기

            $("#PackingOrderLedger2Form :enabled").prop('disabled', true);
            $("#PackingOrderLedger2Grid_1").dxDataGrid("option", "disabled", false);
            //$("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "disabled", true);
            //$("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("option", "disabled", false);

        }

        $("#PackingOrderLedger2Form select[name=order_dept_2]").readonly(true);

        $('#PackingOrderLedger2DatePicker3').datepicker('destroy');
        $('#PackingOrderLedger2DatePicker3').attr('readonly', true);

    }

    // 조회
    function PackingOrderLedger2Search() {

        var formData = $("#PackingOrderLedger2SearchForm").serialize();

        $.ajax({
            type: 'GET',
            url: '/PackingManage/GetPackingOrder',
            data: formData,
            dataType: 'json',
            success: function (result) {

                if (result.length < 1) {
                    $("#PackingOrderLedger2Grid_1").dxDataGrid("option", "dataSource", []);
                    $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "dataSource", []);
                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("option", "dataSource", []);
                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("instance").option("focusedRowEnabled", false);
                    return;
                }

                var json = JSON.parse(result);

                if (json.hasOwnProperty('sessionLoss')) {
                    alert("세션이 만료되었습니다.");
                    sessionStorage.clear();
                    location.replace("/Comm/Login");
                }

                $("#PackingOrderLedger2Grid_1").dxDataGrid("option", "dataSource", json);
                $("#PackingOrderLedger2Grid_1").dxDataGrid("instance").option("focusedRowEnabled", true);
                $("#PackingOrderLedger2Grid_1").dxDataGrid("instance").option("focusedRowIndex", 0);

            }
        })
    }

    // 포장지시 그리드 포커스 변경
    function PackingOrderLedger2SelectPackingOrder() {

        _PackingOrderLedger2SignCnt = 0;

        var grid = $("#PackingOrderLedger2Grid_1").dxDataGrid("instance");
        var data = getGridRowByKey("PackingOrderLedger2Grid_1", grid.option("focusedRowKey"));

        $.ajax({
            type: 'GET',
            url: '/PackingManage/SelectPackingOrderLedgerDetail',
            data: {
                order_id: data.order_id,
                item_cd: data.item_cd,
            },
            success: function (result) {

                if (result[0].length > 0) {
                    $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "dataSource", JSON.parse(result[0]));
                    $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance").option("focusedRowEnabled", true);
                    $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance").option("focusedRowIndex", 0);

                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("option", "dataSource", JSON.parse(result[1]));
                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("instance").option("focusedRowEnabled", true);
                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("instance").option("focusedRowIndex", 0);

                    for (var i = 0; i < JSON.parse(result[1]).length; i++) {
                        _PackingOrderLedger2SignCnt += parseInt(JSON.parse(result[1])[i].sign_yn, 10);
                    }

                    //_PackingOrderLedger2SignCnt = ;

                    $("#PackingOrderLedger2Form input[name=order_start]").val(data.order_date);
                    $("#PackingOrderLedger2Form select[name=order_dept_2]").val(data.making_dept_cd);
                } else {
                    $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "dataSource", []);
                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("option", "dataSource", []);
                    $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("instance").option("focusedRowEnabled", false);
                }
            }
        })

    }

    // 탭 클릭 시, 탭 이동
    function Tabs_itemClick(e) {

        var formData = new FormData($("#PackingOrderLedger2SearchForm")[0]);

        // 현재 보여지고 있는 Tab 이외의 Tab을 선택 했을 시,
        if (e.itemData.id !== _PackingOrderLedger2TabNum) {

            // 1.제조지시대장작성
            if (e.itemData.id === 1) {
                // 이전 Tab display-none
                $("#PackingOrderLedger2Tab_" + _PackingOrderLedger2TabNum).addClass("display-none");
                _PackingOrderLedger2TabNum = '1';
                $("#PackingOrderLedger2Tab_" + _PackingOrderLedger2TabNum).removeClass("display-none");

                // 2.전자서명
            } else if (e.itemData.id === 2) {
                // 이전 Tab display-none
                $("#PackingOrderLedger2Tab_" + _PackingOrderLedger2TabNum).addClass("display-none");
                _PackingOrderLedger2TabNum = '2';
                $("#PackingOrderLedger2Tab_" + _PackingOrderLedger2TabNum).removeClass("display-none");

            }

            // Tab Number
            formData.set("PackingOrderLedger2TabNum", _PackingOrderLedger2TabNum);

        }

    }

    // 검색용 팝업 제품
    function PackingOrderLedger2SearchItem() {
        var popup = $("#PackingOrderLedger2ItemPopup").dxPopup("instance");

        popup.show();
    }

    // 검색용 팝업 제품 로우 더블클릭
    function PackingOrderLedger2ItemRowDblClick(selectedItems) {

        var data = selectedItems.data;

        $("#PackingOrderLedger2ItemCode").val(data.item_cd);

        var popup = $("#PackingOrderLedger2ItemPopup").dxPopup("instance");

        popup.hide();

    }

    // 입력
    function PackingOrderLedger2Input() {

        PackingOrderLedger2Editing(true);
        _PackingOrderLedger2IsEditable = true;
        _PackingOrderLedger2CRUDGubun = "I";
        _PackingOrderLedger2ID = "";

        $('#PackingOrderLedger2DatePicker3').datepicker({
            format: "yyyy-mm-dd",	//데이터 포맷 형식(yyyy : 년 mm : 월 dd : 일 )
            autoclose: true,	//사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
            clearBtn: true, //날짜 선택한 값 초기화 해주는 버튼 보여주는 옵션 기본값 false 보여주려면 true
            disableTouchKeyboard: false,	//모바일에서 플러그인 작동 여부 기본값 false 가 작동 true가 작동 안함.
            templates: {
                leftArrow: '&laquo;',
                rightArrow: '&raquo;'
            }, //다음달 이전달로 넘어가는 화살표 모양 커스텀 마이징
            showWeekDays: true,// 위에 요일 보여주는 옵션 기본값 : true
            todayHighlight: true,	//오늘 날짜에 하이라이팅 기능 기본값 :false
            toggleActive: true,	//이미 선택된 날짜 선택하면 기본값 : false인경우 그대로 유지 true인 경우 날짜 삭제
            language: "ko"	//달력의 언어 선택, 그에 맞는 js로 교체해줘야한다.

        })

        $("#PackingOrderLedger2Form select[name=order_dept_2]").readonly(false);

        $("#PackingOrderLedger2DatePicker3").prop("readonly", false);
        $("#PackingOrderLedger2DatePicker3").datepicker("disabled", false);

        $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "dataSource", []);
        $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("option", "dataSource", []);
        $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("instance").option("focusedRowEnabled", false);

        var today = new Date();

        var year = today.getFullYear();
        var month = ((today.getMonth() + 1) < 10 ? "0" + (today.getMonth() + 1) : (today.getMonth() + 1));
        var date = (today.getDate() < 10 ? "0" + today.getDate() : today.getDate());

        $('#PackingOrderLedger2Form input[name=order_start]').datepicker('update', year + '-' + month + '-' + date);

        var editing = {
            allowUpdating: true,
            allowAdding: true,
            allowDeleting: true,
            mode: 'batch'
        }
        $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "editing", editing);
    }

    // 수정
    function PackingOrderLedger2Edit() {

        _PackingOrderLedger2IsEditable = true;
        _PackingOrderLedger2CRUDGubun = "U";

        if (_PackingOrderLedger2SignCnt > 0) {
            alert("서명된 대장은 수정할 수 없습니다.");
            return;
        }

        var grid = $("#PackingOrderLedger2Grid_1").dxDataGrid("instance");
        var data = getGridRowByKey("PackingOrderLedger2Grid_1", grid.option("focusedRowKey"));

        _PackingOrderLedger2ID = data.order_id;

        PackingOrderLedger2Editing(true);

        var editing = {
            allowUpdating: true,
            allowAdding: true,
            allowDeleting: true,
            mode: 'batch'
        }
        $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "editing", editing);
    }

    // 삭제
    function PackingOrderLedger2Delete() {

        if (_PackingOrderLedger2SignCnt > 0) {
            alert("서명된 대장은 수정할 수 없습니다.");
            return;
        }

        if (!confirm("포장지시를 삭제하시겠습니까?")) {
            return;
        }

        _PackingOrderLedger2CRUDGubun = "D";

        var grid = $("#PackingOrderLedger2Grid_1").dxDataGrid("instance");
        var data = getGridRowByKey("PackingOrderLedger2Grid_1", grid.option("focusedRowKey"));

        var targetData = $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "dataSource");

        _PackingOrderLedger2ID = data.order_id;

        PackingOrderLedger2CRUDExcute(targetData);

    }

    // 저장
    async function PackingOrderLedger2Save() {

        if (!confirm("변경사항을 저장하시겠습니까?")) {
            return;
        }

        _isOK = true;

        await $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance").saveEditData();

        if (!_PackingOrderLedger2IsValid) {
            return;
        }

        PackingOrderLedger2CRUDExcute(_PackingOrderLedger2Changes);
    }

    function PackingOrderLedger2CRUDExcute(data) {

        if (!_isOK) {
            alert("필수값을 입력해주세요.");
            return;
        }

        $.ajax({
            type: 'POST',
            url: '/PackingManage/PackingOrderLedgerCRUD',
            data: {
                packingOrders: JSON.stringify(data),
                order_date: $("#PackingOrderLedger2DatePicker3").val(),
                making_dept_cd: $("#PackingOrderLedger2Dept_2").val(),
                order_id: _PackingOrderLedger2ID,
                gubun: _PackingOrderLedger2CRUDGubun
            },
            dataType: 'json',
            async: false,
            success: function (result) {

                var jsonData = JSON.parse(result);

                if (jsonData.hasOwnProperty("failMessege")) {
                    alert(jsonData.failMessege.replace(/\\n/g, "\\n"));

                    return;
                }

                alert(jsonData.resultMessege);

                _PackingOrderLedger2Changes = new Array();

                var editing = {
                    allowUpdating: false,
                    allowAdding: false,
                    allowDeleting: false
                }

                $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "editing", editing);

                _PackingOrderLedger2CRUDGubun = "";
                _PackingOrderLedger2IsEditable = false;

                PackingOrderLedger2Editing(false);

                PackingOrderLedger2Search();
            }
        })
    }

    // 취소
    function PackingOrderLedger2Undo() {

        if (!confirm("작성내용을 취소하시겠습니까?")) {
            return;
        }

        _PackingOrderLedger2Changes = new Array();

        var editing = {
            allowUpdating: false,
            allowAdding: false,
            allowDeleting: false
        }

        $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("option", "editing", editing);

        _PackingOrderLedger2CRUDGubun = "";
        _PackingOrderLedger2IsEditable = false;

        PackingOrderLedger2Editing(false);

        PackingOrderLedger2SelectPackingOrder();
    }


    async function PackingOrderLedger2Update(info) {

        var data = info.data;


        if (data == null || data.order_qty == null || typeof (data.order_qty) === "undefined" || data.order_qty === "") {
            _isOK = false;
            return;
        }

        if (_PackingOrderLedger2CRUDGubun === "I") {
            data.gubun = "I";
            delete data.__KEY__;
        } else {
            data.gubun = "U";
        }

        _PackingOrderLedger2Changes.push(data);

    }

    function PackingOrderLedger2Insert(info) {

        var data = info.data;

        if (data == null || data.order_qty == null || typeof (data.order_qty) === "undefined" || data.order_qty === "") {
            _isOK = false;
            return;
        }

        data.gubun = "I";

        delete data.__KEY__;

        _PackingOrderLedger2Changes.push(data);
    }

    function PackingOrderLedger2DeleteOrder(info) {

        var data = info.data;

        if (_PackingOrderLedger2CRUDGubun === "I") {

            var idx = _PackingOrderLedger2Changes.findIndex(function (item) {
                return item.order_no === data.order_no;
            });

            _PackingOrderLedger2Changes.splice(idx, 1);

            return;
        }

        data.gubun = "D";

        _PackingOrderLedger2Changes.push(data);

    }

    // 전자서명 테이블 클릭
    function PackingOrderLedger2Sign(e) {

        _PackingOrderLedger2SignData = e.data;

        if (e.columnIndex == 3) {
            _PackingOrderLedger2SignGubun = "UpdateSignature";

            if (e.data.prev_sign_yn == "0") {
                alert("먼저 앞 단계 승인이 필요합니다.");
                return;
            }

            if (e.data.sign_yn == "1") {

                if (e.data.next_sign_yn == "1") {
                    alert("이미 다음 단계가 승인 되어 있습니다.\n먼저 다음 단계 승인을 삭제(취소)해주세요. ");
                    return;
                }

                if (confirm("이미 승인 되었습니다. 서명을 삭제하시겠습니까?")) {
                    _PackingOrderLedger2SignGubun = "DeleteSignature";
                } else {
                    return;
                }

            }

            var popup = $("#PackingOrderLedger2SignPopup").dxPopup("instance");
            popup.option("contentTemplate", $("#PackingOrderLedger2SignPopupTemplate"));
            popup.show();

        }
    }

    // 서명 권한 체크(id, pw)
    function PackingOrderLedger2SignSubmit() {

        var data = new FormData($('#PackingOrderLedger2Sign_Form')[0]);

        var datagrid1 = $("#PackingOrderLedger2Grid_1").dxDataGrid("instance");
        var datagrid2 = $("#PackingOrderLedger2Grid_Tab_2").dxDataGrid("instance");

        data.set("gubun", "S");

        var gridData1 = getGridRowByKey("PackingOrderLedger2Grid_1", datagrid1.option("focusedRowKey"));
        var gridData2 = getGridRowByKey("PackingOrderLedger2Grid_Tab_2", datagrid2.option("focusedRowKey"));

        $.ajax({
            type: 'POST',
            url: '/Comm/IDValidation',
            data: data,
            contentType: false,
            processData: false,
            success: function (result) {

                if (result.length <= 0) {
                    alert("잘못된 ID,PW 입니다.");
                    return;
                }

                var isOK = false;

                if (_PackingOrderLedger2SignData.responsible_emp_cd !== JSON.parse(result)[0].emp_cd) {

                    $.ajax({
                        type: 'GET',
                        url: '/Comm/DelegateCheck',
                        data: {
                            emp_cd: JSON.parse(result)[0].emp_cd,
                            sign_set_cd: "2008",
                            sign_set_seq: gridData2.sign_set_dt_seq
                        },
                        async: false,
                        success: function (result) {

                            if (result.length > 0) {
                                isOK = true;
                            } else {
                                isOK = false;
                            }
                        }
                    });
                } else {
                    isOK = true;
                }

                if (!isOK) {
                    alert("권한이 없는 사용자입니다.");
                    return;
                }

                $("#PackingOrderLedger2SignConfirmForm input[name='dept_nm']").val(JSON.parse(result)[0].dept_nm);
                $("#PackingOrderLedger2SignConfirmForm input[name='emp_nm']").val(JSON.parse(result)[0].emp_nm);

                setTimeout(function () {
                    $.ajax({
                        type: 'POST',
                        url: '/PackingManage/PackingOrderSignCRUD',
                        data: {
                            gubun: _PackingOrderLedger2SignGubun,
                            c_seq: gridData2.sign_set_dt_seq,
                            emp_cd: JSON.parse(result)[0].emp_cd,
                            order_id: gridData1.order_id,
                            validation_type: "2",
                            sign_status: _PackingOrderLedger2SignCnt
                        },
                        success: function (result) {

                            alert(JSON.parse(result).messege);

                            PackingOrderLedger2SelectPackingOrder();

                        }
                    });

                    _PackingOrderLedger2SignGubun = "";

                    var popup = $("#PackingOrderLedger2SignPopup").dxPopup("instance");
                    popup.hide();
                }, 1000);
            }
        });

    }

    // 서명 인풋 초기화
    function clearPackingOrderLedger2SignInput() {
        $('#PackingOrderLedger2Sign_Form')[0].reset();
        $("#PackingOrderLedger2SignConfirmForm input[name='dept_nm']").val("");
        $("#PackingOrderLedger2SignConfirmForm input[name='emp_nm']").val("");
    }

    // 컬럼 클릭 이벤트 제한
    function PackingOrderEditableColumn(cellElement, cellInfo) {

        if (cellElement.rowType != "data" || !cellElement.isEditing)
            return;
        if (cellElement.column.dataField === 'order_no' && !cellElement.row.inserted)
            cellElement.element.find('input').prop('disabled', true);
        if (cellElement.column.dataField === 'item_nm' && !cellElement.row.inserted)
            cellElement.element.find('input').prop('disabled', true);
        if (cellElement.column.dataField === 'order_status_nm' && !cellElement.row.inserted)
            cellElement.element.find('input').prop('disabled', true);

    }

    // 제조제품 조회 팝업
    function PackingOrderLedger2CellClick(e) {
        if (e.columnIndex == 8) {
            $.ajax({
                type: 'POST',
                url: '/PackingManage/GetPackingOrderSignData',
                data: {
                    packing_order_no: e.data.order_no
                },
                success: function (result) {
                    if (result.length <= 0) {

                        var popup = $("#PackingOrderLedger_Plan_subContentPopup").dxPopup("instance");
                        popup.option("contentTemplate", $("#PackingOrderLedger_Plan_subContentPopup_Template"));

                        popup.show();

                        $("input.datetime_mask").mask('0000/00/00 00:00', { placeholder: "____/__/__ 00:00" });

                        PopupFormInsertData("0");

                        var columns = [
                            { dataField: "emp_nm", caption: "사원명" },
                            { dataField: "dept_nm", caption: "부서명" },
                            { dataField: "emp_post_nm", caption: "직위" }
                        ];

                        createPopup("PackingOrderLedger_Plan_Popup_Emp", "사원조회", @employeePopupData, columns);
                    } else if (result.length > 0) {
                        var data = JSON.parse(result);

                        if (data[data.length - 1].sign_yn == "0") {

                            var popup = $("#PackingOrderLedger_Plan_subContentPopup").dxPopup("instance");
                            popup.option("contentTemplate", $("#PackingOrderLedger_Plan_subContentPopup_Template"));

                            popup.show();

                            $("input.datetime_mask").mask('0000/00/00 00:00', { placeholder: "____/__/__ 00:00" });

                            PopupFormInsertData("0");

                            var columns = [
                                { dataField: "emp_nm", caption: "사원명" },
                                { dataField: "dept_nm", caption: "부서명" },
                                { dataField: "emp_post_nm", caption: "직위" }
                            ];

                            createPopup("PackingOrderLedger_Plan_Popup_Emp", "사원조회", @employeePopupData, columns);
                        } else {

                            var popup = $("#PackingOrderLedger_Check_subContentPopup").dxPopup("instance");
                            popup.option("contentTemplate", $("#PackingOrderLedger_Check_subContentPopup_Template"));

                            popup.show();

                            $("input.datetime_mask").mask('0000/00/00 00:00', { placeholder: "____/__/__ 00:00" });

                            PopupFormInsertData("1");
                        }

                    }
                }
            });
        }


        if (!_PackingOrderLedger2IsEditable) {
            return;
        }

        _packingOrderLedgerCellClickEvent = e;

        if (e.columnIndex == 2) {
            var grid = $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance");
            var visibleData = grid.getVisibleRows()[e.rowIndex];

            if (typeof visibleData.data.order_qty == "undefined") {
                alert("지시 수량을 입력해주세요.");
                return;
            } else {

                var requestData = {
                    dept_cd: $("#PackingOrderLedger2Dept_2").val(),
                    batch_size: e.data.order_qty
                };

                $.ajax({
                    type: "GET",
                    url: '/PackingManage/SelectItemPopup',
                    traditional: true,
                    data: requestData
                }).done(function (response) {
                    var popup = $("#PackingOrderLedgerItemPopup2").dxPopup('instance');

                    popup.option("contentTemplate", function (content) {

                        content.append(response);
                    });

                    popup.show();

                }).fail(function (data) {
                    alert("Failed: " + data.response);
                });
            }

        }


        //else if (e.columnIndex == 4) {

        //    if (!e.data.item_cd) {
        //        alert("제품코드를 선택해주세요.");
        //        return;
        //    } else {

        //        var requestData = {
        //            item_cd: e.data.item_cd,
        //        };

        //        $.ajax({
        //            type: "GET",
        //            url: '/PackingManage/SelectOrderPopup',
        //            traditional: true,
        //            data: requestData
        //        }).done(function (response) {
        //            var popup = $("#PackingOrderLedgerOrderPopup").dxPopup('instance');

        //            popup.option("contentTemplate", function (content) {

        //                content.append(response);
        //            });

        //            popup.show();

        //        }).fail(function (data) {
        //            alert("Failed: " + data.response);
        //        });

        //    }

        //}

    }


    function PopupFormInsertData() {
        // 매개변수가 0 일 경우 생산계획 폼에 값 입력
        if (arguments[0] == "0") {
            $("form#PackingOrderLedger_Plan_Popup_Form input#order_qty").val($("form#PackingOrderLedger_Plan_Form input#order_qty").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#item_packunit").val($("form#PackingOrderLedger_Plan_Form input#item_packunit").val());

            $("form#PackingOrderLedger_Plan_Popup_Form input#UPH_qty").val($("form#PackingOrderLedger_Plan_Form input#UPH_qty").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#qty_HR").val($("form#PackingOrderLedger_Plan_Form input#qty_HR").val());

            $("form#PackingOrderLedger_Plan_Popup_Form input#start_hour").val($("form#PackingOrderLedger_Plan_Form input#start_time").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#stop_hour").val($("form#PackingOrderLedger_Plan_Form input#stop_time").val());
            if ($("form#PackingOrderLedger_Plan_Form input#work_time").val().length > 0) {
                $("form#PackingOrderLedger_Plan_Popup_Form input#work_time").val($("form#PackingOrderLedger_Plan_Form input#work_time").val());
            } else {
                $("form#PackingOrderLedger_Plan_Popup_Form input#work_time").val("-");
            }

            $("form#PackingOrderLedger_Plan_Popup_Form input#UPS_qty").val($("form#PackingOrderLedger_Plan_Form input#UPS_qty").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#qty_SEC").val($("form#PackingOrderLedger_Plan_Form input#qty_SEC").val());

            $("form#PackingOrderLedger_Plan_Popup_Form input#item_content").val($("form#PackingOrderLedger_Plan_Form input#item_content").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#item_content_unit").val($("form#PackingOrderLedger_Plan_Form input#item_content_unit").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#item_error_range").val($("form#PackingOrderLedger_Plan_Form input#item_error_range").val());


            $("form#PackingOrderLedger_Plan_Popup_Form input#worker_qty").val($("form#PackingOrderLedger_Plan_Form input#worker_qty").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#MAN_qty").val($("form#PackingOrderLedger_Plan_Form input#MAN_qty").val());

            $("form#PackingOrderLedger_Plan_Popup_Form input#plan_emp_nm").val($("form#PackingOrderLedger_Plan_Form input#plan_emp_nm").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#plan_emp_cd").val($("form#PackingOrderLedger_Plan_Form input#plan_emp_cd").val());
            $("form#PackingOrderLedger_Plan_Popup_Form input#plan_emp_post_nm").val($("form#PackingOrderLedger_Plan_Form input#plan_emp_post_nm").val());

        } else {
            var time_check = $("form#PackingOrderLedger_Result_Form input#time_check").val();

            // 종료시간이 입력되지 않았으면 집계 버튼을 숨김
            if ($("form#PackingOrderLedger_Check_Form input#insert_time").val() == null || $("form#PackingOrderLedger_Check_Form input#insert_time").val() == "") {
                // 생산수량
                $("form#PackingOrderLedger_Check_Popup_Form input#goal_qty").val($("form#PackingOrderLedger_Result_Form input#goal_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#item_packunit").val($("form#PackingOrderLedger_Result_Form input#item_packunit").val());

                // 진행율
                $("form#PackingOrderLedger_Check_Popup_Form input#progress_rate").val($("form#PackingOrderLedger_Result_Form input#progress_rate").val());

                // 양품율
                $("form#PackingOrderLedger_Check_Popup_Form input#gd_rate").val($("form#PackingOrderLedger_Result_Form input#gd_rate").val());

                // 불량율
                $("form#PackingOrderLedger_Check_Popup_Form input#defect_qty").val($("form#PackingOrderLedger_Result_Form input#defect_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#defect_rate").val($("form#PackingOrderLedger_Result_Form input#defect_rate").val());

                // 생산시간
                $("form#PackingOrderLedger_Check_Popup_Form input#start_hour").val($("form#PackingOrderLedger_Result_Form input#start_datetime").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#stop_hour").val($("form#PackingOrderLedger_Result_Form input#stop_datetime").val());

                if (time_check == "Y") {
                    $("form#PackingOrderLedger_Check_Popup_Form input#work_time").val("-");
                } else {
                    $("form#PackingOrderLedger_Check_Popup_Form input#work_time").val($("form#PackingOrderLedger_Result_Form input#work_time").val());
                }

                // UPS_QTY
                $("form#PackingOrderLedger_Check_Popup_Form input#UPS_qty").val($("form#PackingOrderLedger_Result_Form input#UPS_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#qty_SEC").val($("form#PackingOrderLedger_Result_Form input#qty_SEC").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#UPH_qty").val($("form#PackingOrderLedger_Result_Form input#UPH_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#qty_HR").val($("form#PackingOrderLedger_Result_Form input#qty_HR").val());


                // 평균중량
                $("form#PackingOrderLedger_Check_Popup_Form input#item_content_avg").val($("form#PackingOrderLedger_Result_Form input#item_content_avg").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#item_content_unit").val($("form#PackingOrderLedger_Result_Form input#item_content_unit").val());


                // 표준편차
                $("form#PackingOrderLedger_Check_Popup_Form input#item_error_range").val($("form#PackingOrderLedger_Result_Form input#item_error_range").val());

                $("form#PackingOrderLedger_Check_Popup_Form input#worker_qty").val($("form#PackingOrderLedger_Result_Form input#worker_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val($("form#PackingOrderLedger_Result_Form input#MAN_qty").val());

                $("form#PackingOrderLedger_Check_Popup_Form input#plan_emp_nm").val($("form#PackingOrderLedger_Result_Form input#plan_emp_nm").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#plan_emp_post_nm").val($("form#PackingOrderLedger_Result_Form input#plan_emp_post_nm").val());

                $("form#PackingOrderLedger_Check_Popup_Form div.input-wrapper").last().addClass("display-none");

                form_status(false);
            } else {
                // 생산수량
                $("form#PackingOrderLedger_Check_Popup_Form input#goal_qty").val($("form#PackingOrderLedger_Check_Form input#goal_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#item_packunit").val($("form#PackingOrderLedger_Check_Form input#item_packunit").val());

                // 진행율
                $("form#PackingOrderLedger_Check_Popup_Form input#progress_rate").val($("form#PackingOrderLedger_Check_Form input#progress_rate").val());

                // 양품율
                $("form#PackingOrderLedger_Check_Popup_Form input#gd_rate").val($("form#PackingOrderLedger_Check_Form input#gd_rate").val());

                // 불량율
                $("form#PackingOrderLedger_Check_Popup_Form input#defect_qty").val($("form#PackingOrderLedger_Check_Form input#defect_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#defect_rate").val($("form#PackingOrderLedger_Check_Form input#defect_rate").val());

                // 생산시간
                $("form#PackingOrderLedger_Check_Popup_Form input#start_hour").val($("form#PackingOrderLedger_Result_Form input#start_datetime").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#stop_hour").val($("form#PackingOrderLedger_Result_Form input#stop_datetime").val());

                if (time_check == "Y") {
                    $("form#PackingOrderLedger_Check_Popup_Form input#work_time").val("-");
                } else {
                    $("form#PackingOrderLedger_Check_Popup_Form input#work_time").val($("form#PackingOrderLedger_Result_Form input#work_time").val());
                }

                // UPS_QTY
                $("form#PackingOrderLedger_Check_Popup_Form input#UPS_qty").val($("form#PackingOrderLedger_Check_Form input#UPS_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#qty_SEC").val($("form#PackingOrderLedger_Check_Form input#qty_SEC").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#UPH_qty").val($("form#PackingOrderLedger_Check_Form input#UPH_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#qty_HR").val($("form#PackingOrderLedger_Check_Form input#qty_HR").val());


                // 평균중량
                $("form#PackingOrderLedger_Check_Popup_Form input#item_content_avg").val($("form#PackingOrderLedger_Check_Form input#item_content_avg").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#item_content_unit").val($("form#PackingOrderLedger_Check_Form input#item_content_unit").val());


                // 표준편차
                $("form#PackingOrderLedger_Check_Popup_Form input#item_error_range").val($("form#PackingOrderLedger_Check_Form input#item_error_range").val());

                $("form#PackingOrderLedger_Check_Popup_Form input#worker_qty").val($("form#PackingOrderLedger_Check_Form input#worker_qty").val());
                $("form#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val($("form#PackingOrderLedger_Check_Form input#MAN_qty").val());

                $("form#PackingOrderLedger_Check_Popup_Form div.input-wrapper").last().removeClass("display-none");
                $("form#PackingOrderLedger_Check_Popup_Form textarea#check_remark").text($("form#PackingOrderLedger_Check_Form input#remark").val());

                form_status(true);
            }

        }
    }


    function form_status(value) {
        if (value) {
            $("#PackingOrderLedger_Check_subContentPopup_Total").dxButton().parent().parent().removeClass("display-none");

            $("form#PackingOrderLedger_Check_Popup_Form input#goal_qty").attr("readonly", false);
            $("form#PackingOrderLedger_Check_Popup_Form input#defect_qty").attr("readonly", false);
            $("form#PackingOrderLedger_Check_Popup_Form input#item_content_avg").attr("readonly", false);
            $("form#PackingOrderLedger_Check_Popup_Form input#item_error_range").attr("readonly", false);

            $("form#PackingOrderLedger_Check_Popup_Form input#start_hour").attr("readonly", true);
            $("form#PackingOrderLedger_Check_Popup_Form input#stop_hour").attr("readonly", true);

            $("form#PackingOrderLedger_Check_Popup_Form input#worker_qty").attr("readonly", true);

            $("form#PackingOrderLedger_Check_Popup_Form input#check_yn").val("Y");

        } else {
            $("#PackingOrderLedger_Check_subContentPopup_Total").dxButton().parent().parent().addClass("display-none");

            $("form#PackingOrderLedger_Check_Popup_Form input#goal_qty").attr("readonly", true);
            $("form#PackingOrderLedger_Check_Popup_Form input#defect_qty").attr("readonly", true);
            $("form#PackingOrderLedger_Check_Popup_Form input#item_content_avg").attr("readonly", true);
            $("form#PackingOrderLedger_Check_Popup_Form input#item_error_range").attr("readonly", true);

            $("form#PackingOrderLedger_Check_Popup_Form input#start_hour").attr("readonly", false);
            $("form#PackingOrderLedger_Check_Popup_Form input#stop_hour").attr("readonly", false);

            $("form#PackingOrderLedger_Check_Popup_Form input#worker_qty").attr("readonly", false);

            $("form#PackingOrderLedger_Check_Popup_Form input#check_yn").val("N");
            $("form#PackingOrderLedger_Check_Popup_Form input#stop_time").val("00:00");
        }

    }

    function setPackingOrderData() {

    }

    // 버튼 컬럼
    function PackingOrderLedger2CellWithButton(container, cellInfo) {

        $("<div>").html("<div style='float:left; line-height: 2;'>" + cellInfo.value + "</div><div style='float:right;' class='icon-plus'></div>")
            .appendTo(container);

        $(".icon-plus").dxButton({
            icon: "search",
            onClick: function (e) {

            }
        });
    }

    function PackingOrderGridValidation(e) {
        _PackingOrderLedger2IsValid = e.isValid;
    }



    // 버튼 컬럼
    function PackingOrderLedgerCellWithButton(container) {
        $("<div>").html("<div class='icon-check'></div>")
            .appendTo(container);

        $(".icon-check").dxButton({
            icon: "edit",
            onClick: function (e) {

            }
        });
    }


    function WorkTime_Insert() {
        var start_hour = "";
        var stop_hour = "";

        if (arguments[0] == "1" || arguments[0] == "2") {
            start_hour = $("#PackingOrderLedger_Plan_Popup_Form input#start_hour").val();
            stop_hour = $("#PackingOrderLedger_Plan_Popup_Form input#stop_hour").val();

            if (arguments[0] == "1") {
                if (parseInt(start_hour.substr(11, 2)) <= 0 || parseInt(start_hour.substr(11, 2)) > 24) {
                    $("#PackingOrderLedger_Plan_Popup_Form input#start_hour").val("");
                    return;
                }

                if (parseInt(start_hour.substr(14, 2)) < 0 || parseInt(start_hour.substr(14, 2)) >= 60) {
                    $("#PackingOrderLedger_Plan_Popup_Form input#start_hour").val("");
                    return;
                }
            }
            if (arguments[0] == "2") {
                if (parseInt(stop_hour.substr(11, 2)) <= 0 || parseInt(start_hour.substr(11, 2)) > 24) {
                    $("#PackingOrderLedger_Plan_Popup_Form input#stop_hour").val("");
                    return;
                }

                if (parseInt(stop_hour.substr(14, 2)) < 0 || parseInt(start_hour.substr(14, 2)) >= 60) {
                    $("#PackingOrderLedger_Plan_Popup_Form input#stop_hour").val("");
                    return;
                }
            }

        } else {
            start_hour = $("#PackingOrderLedger_Check_Popup_Form input#start_hour").val();
            stop_hour = $("#PackingOrderLedger_Check_Popup_Form input#stop_hour").val();

            if (arguments[0] == "3") {

                if (parseInt(start_hour.substr(11, 2)) <= 0 || parseInt(start_hour.substr(11, 2)) > 24) {
                    $("#PackingOrderLedger_PlaPackingOrderLedger_Check_Popup_Formn_Popup_Form input#start_hour").val("");
                    return;
                }

                if (parseInt(start_hour.substr(14, 2)) < 0 || parseInt(start_hour.substr(14, 2)) >= 60) {
                    $("#PackingOrderLedger_Check_Popup_Form input#start_hour").val("");
                    return;
                }

            }
            if (arguments[0] == "4") {

                if (parseInt(stop_hour.substr(11, 2)) <= 0 || parseInt(stop_hour.substr(11, 2)) > 24) {
                    $("#PackingOrderLedger_Check_Popup_Form input#stop_hour").val("");
                    return;
                }

                if (parseInt(start_hour.substr(14, 2)) < 0 || parseInt(start_hour.substr(14, 2)) >= 60) {
                    $("#PackingOrderLedger_Check_Popup_Form input#stop_hour").val("");
                    return;
                }

            }
        }

        if (start_hour.length > 0 && stop_hour.length > 0) {
            var start_time = new Date(start_hour);
            var stop_time = new Date(stop_hour);

            var work_time = stop_time - start_time;
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_lunch && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_lunch) {
                work_time = work_time - 3600000;
            }
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_dinner && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_dinner) {
                work_time = work_time - 3600000;
            }
            var hour = Math.floor((work_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var min = Math.floor((work_time % (1000 * 60 * 60)) / (1000 * 60));
            if (work_time >= 86400000) {
                var day = parseInt(work_time / 86400000);

                hour = hour + (day * 24);
            }

            var hour_min = hour + "시간 " + min + "분";
            if (arguments[0] == "1" || arguments[0] == "2") {

                $("#PackingOrderLedger_Plan_Popup_Form input#work_time").val(hour_min);

                UPH_Insert(work_time, "1");
            } else {

                $("#PackingOrderLedger_Check_Popup_Form input#work_time").val(hour_min);

                UPH_Insert(work_time, "2");
            }

        }
        //if (temp_start >= 0 && temp_stop >= 0) {
        //    $("#PackingOrderLedger_Plan_Popup_Form input#work_time").val("0HR");
        //    $("#PackingOrderLedger_Check_Popup_Form input#work_time").val("0HR");

        //    $("form#PackingOrderLedger_Check_Popup_Form input#UPH_qty").val(0);
        //    $("form#PackingOrderLedger_Check_Popup_Form input#UPS_qty").val(0);

        //    // 시작시간이 점심시간, 저녁시간일 경우 - 1
        //    if (parseInt(temp_start) <= 12 && parseInt(temp_stop) > 12) {
        //        temp_start = parseInt(temp_start) + 1;
        //    }

        //    if (parseInt(temp_start) <= 18 && parseInt(temp_stop) > 18) {
        //        temp_start = parseInt(temp_start) + 1;
        //    }

        //    if (temp_start == "") {
        //        temp_start = 0;
        //    }
        //    if (temp_stop == "") {
        //        temp_stop = 0;
        //    }


        //    if (parseInt(temp_start) < parseInt(temp_stop)) {

        //        if (arguments[0] == "1" || arguments[0] == "2") {

        //            $("#PackingOrderLedger_Plan_Popup_Form input#work_time").val((temp_stop - temp_start) + "HR");

        //            UPH_Insert(temp_stop - temp_start, "1");
        //        } else {

        //            $("#PackingOrderLedger_Check_Popup_Form input#work_time").val((temp_stop - temp_start) + "HR");

        //            UPH_Insert(temp_stop - temp_start, "2");
        //        }
        //    }
        //}
    }


    function MAN_Insert() {
        if (arguments[0] == "0") {
            var order_qty = $("#PackingOrderLedger_Plan_Popup_Form input#order_qty").val().replace(/,/g, "");
            var worker_qty = $("#PackingOrderLedger_Plan_Popup_Form input#worker_qty").val().replace(/,/g, "");

            if (order_qty.length > 0 && worker_qty.length > 0) {
                //$("#PackingOrderLedger_Plan_Popup_Form input#MAN_qty").val(Number_Format((order_qty / worker_qty).toFixed(3)));
                $("#PackingOrderLedger_Plan_Popup_Form input#MAN_qty").val((order_qty / worker_qty).toFixed(2));
            }
        } else {
            var goal_qty = $("#PackingOrderLedger_Check_Popup_Form input#goal_qty").val().replace(/,/g, "");
            var worker_qty = $("#PackingOrderLedger_Check_Popup_Form input#worker_qty").val().replace(/,/g, "");

            if (goal_qty.length > 0 && worker_qty.length > 0) {
                //$("#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val(Number_Format((goal_qty / worker_qty).toFixed(3)));
                $("#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val((goal_qty / worker_qty).toFixed(2));
            }
        }
    }


    function GoalQty_Change() {
        var order_qty = $("#PackingOrderLedger_Plan_Form input#order_qty").val().replace(/,/g, "");
        var goal_qty = $("#PackingOrderLedger_Check_Popup_Form input#goal_qty").val().replace(/,/g, "");
        var worker_qty = $("#PackingOrderLedger_Check_Popup_Form input#worker_qty").val().replace(/,/g, "");
        var defect_qty = $("#PackingOrderLedger_Check_Popup_Form input#defect_qty").val().replace(/,/g, "");

        var start_hour = $("#PackingOrderLedger_Check_Popup_Form input#start_hour").val().substr(0, 16);
        var stop_hour = $("#PackingOrderLedger_Check_Popup_Form input#stop_hour").val().substr(0, 16);
        var work_time = new Date(stop_hour) - new Date(start_hour);

        if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_lunch && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_lunch) {
            work_time = work_time - 3600000;
        }
        if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_dinner && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_dinner) {
            work_time = work_time - 3600000;
        }


        //$("form#PackingOrderLedger_Check_Popup_Form input#progress_rate").val(Number_Format(((goal_qty / order_qty) * 100).toFixed(3)) + " %");
        $("form#PackingOrderLedger_Check_Popup_Form input#progress_rate").val(((goal_qty / order_qty) * 100).toFixed(3) + " %");
        if (goal_qty > 0 && worker_qty > 0) {
            //$("form#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val(Number_Format((goal_qty / worker_qty).toFixed(3)));
            $("form#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val((goal_qty / worker_qty).toFixed(3));
        } else {
            $("form#PackingOrderLedger_Check_Popup_Form input#MAN_qty").val(0);
        }
        //$("form#PackingOrderLedger_Check_Popup_Form input#gd_rate").val(Number_Format((((goal_qty - defect_qty) / goal_qty) * 100).toFixed(3)) + " %");
        $("form#PackingOrderLedger_Check_Popup_Form input#gd_rate").val((((goal_qty - defect_qty) / goal_qty) * 100).toFixed(3) + " %");
        UPH_Insert(work_time, 2);

    }


    function DefectQty_Chagne   () {
        var order_qty = $("#PackingOrderLedger_Plan_Form input#order_qty").val().replace(/,/g, "");
        var goal_qty = $("#PackingOrderLedger_Check_Popup_Form input#goal_qty").val().replace(/,/g, "");
        var defect_qty = $("#PackingOrderLedger_Check_Popup_Form input#defect_qty").val().replace(/,/g, "");

        //$("form#PackingOrderLedger_Check_Popup_Form input#gd_rate").val(Number_Format((((goal_qty - defect_qty) / goal_qty) * 100).toFixed(3)) + " %");
        $("form#PackingOrderLedger_Check_Popup_Form input#gd_rate").val((((goal_qty - defect_qty) / goal_qty) * 100).toFixed(2) + " %");
        //$("form#PackingOrderLedger_Check_Popup_Form input#defect_rate").val(Number_Format(((defect_qty / order_qty) * 100).toFixed(3)) + " %");
        $("form#PackingOrderLedger_Check_Popup_Form input#defect_rate").val(((defect_qty / order_qty) * 100).toFixed(2) + " %");
    }


    function UPH_Insert(work_time, type) {
        var hour = Math.floor((work_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var sec = work_time / 1000;

        if (work_time >= 86400000) {
            var day = parseInt(work_time / 86400000);

            hour = hour + (day * 24);
        }

        if (type == "1") {
            var order_qty = $("form#PackingOrderLedger_Plan_Popup_Form input#order_qty").val().replace(/,/g, "");

            var UPH_qty = Number_Format(Number_Change((order_qty / hour), 2));
            var UPS_qty = Number_Format(Number_Change((order_qty / sec), 2));

            $("form#PackingOrderLedger_Plan_Popup_Form input#UPH_qty").val(UPH_qty);
            $("form#PackingOrderLedger_Plan_Popup_Form input#UPS_qty").val(UPS_qty);

        } else {
            if (work_time == 0) {
                $("form#PackingOrderLedger_Check_Popup_Form input#UPH_qty").val(0);
                $("form#PackingOrderLedger_Check_Popup_Form input#UPS_qty").val(0);

                return;
            }
            var goal_qty = $("form#PackingOrderLedger_Check_Popup_Form input#goal_qty").val().replace(/,/g, "");
            console.log(goal_qty);
            console.log(hour)
            console.log(sec)
            var UPH_qty = Number_Format(Number_Change((goal_qty / hour), 2));
            var UPS_qty = Number_Format(Number_Change((goal_qty / sec), 2));
            console.log(UPH_qty); console.log(UPS_qty);

            $("form#PackingOrderLedger_Check_Popup_Form input#UPH_qty").val(UPH_qty);
            $("form#PackingOrderLedger_Check_Popup_Form input#UPS_qty").val(UPS_qty);
        }
    }


    function PackingOrderLedger_Plan_Popup_clear() {
        $('#PackingOrderLedger_Plan_Popup_Form')[0].reset();
        $('#PackingOrderLedger_Plan_Popup_Form input#plan_emp_cd').val("");
    }


    function PackingOrderLedger_Check_Popup_clear() {
        $('#PackingOrderLedger_Check_Popup_Form')[0].reset();
        $('#PackingOrderLedger_Check_Popup_Form input#plan_emp_cd').val("");
    }


    function PackingOrderLedger2RowSelect() {
        // 생산계획, 생산실적 폼 초기화
        $('#PackingOrderLedger_Plan_Form')[0].reset();
        $('#PackingOrderLedger_Check_Form')[0].reset();
        $('#PackingOrderLedger_Result_Form')[0].reset();

        var grid = $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance");

        if (grid.totalCount() > 0) {
            var gridData = getGridRowByKey("PackingOrderLedgerGrid_Tab_1", grid.option("focusedRowKey"));

            $.ajax({
                type: 'POST',
                url: '/PackingManage/GetItemInfo',
                data: {
                    item_cd: gridData.item_cd,
                    packing_order_no: gridData.order_no
                },
                success: function (result) {
                    var jsonData = new Array();
                    for (let i = 0; i < result.length; i++) {

                        if (result[i] != "" && result[i] != null) {
                            jsonData[i] = JSON.parse(result[i]);
                        }
                        else {
                            jsonData[i] = result[i];
                        }

                    }

                    if (jsonData[0].length > 0) {
                        // 생산계획
                        $("form#PackingOrderLedger_Plan_Form input#item_content").val(jsonData[0][0].item_content);
                        $("form#PackingOrderLedger_Plan_Form input#item_content_unit").val(jsonData[0][0].item_content_unit);
                        $("form#PackingOrderLedger_Plan_Form input#item_packunit").val(jsonData[0][0].item_packunit);

                        $("form#PackingOrderLedger_Plan_Form input#qty_HR").val(jsonData[0][0].item_packunit + "/HR");
                        $("form#PackingOrderLedger_Plan_Form input#qty_SEC").val(jsonData[0][0].item_packunit + "/SEC");
                        $("form#PackingOrderLedger_Plan_Form input#item_error_range").val(jsonData[0][0].item_error_range);

                        //$("form#PackingOrderLedger_Plan_Form input#order_qty").val(Number_Format(gridData.order_qty));
                        $("form#PackingOrderLedger_Plan_Form input#order_qty").val(Number_Format(Number_Change(gridData.order_qty, 0)));

                        // 생산실적
                        $("form#PackingOrderLedger_Check_Form input#item_content_unit").val(jsonData[0][0].item_content_unit);
                        $("form#PackingOrderLedger_Check_Form input#item_packunit").val(jsonData[0][0].item_packunit);

                        $("form#PackingOrderLedger_Check_Form input#qty_HR").val(jsonData[0][0].item_packunit + "/HR");
                        $("form#PackingOrderLedger_Check_Form input#qty_SEC").val(jsonData[0][0].item_packunit + "/SEC");

                        // 수동실적
                        $("form#PackingOrderLedger_Result_Form input#item_content_unit").val(jsonData[0][0].item_content_unit);
                        $("form#PackingOrderLedger_Result_Form input#item_packunit").val(jsonData[0][0].item_packunit);

                        $("form#PackingOrderLedger_Result_Form input#qty_HR").val(jsonData[0][0].item_packunit + "/HR");
                        $("form#PackingOrderLedger_Result_Form input#qty_SEC").val(jsonData[0][0].item_packunit + "/SEC");
                    }
                   
                    if (jsonData[1] != null) {
                        PlanFormInsert(jsonData);
                        ResultFormInsert(jsonData, gridData);
                        CheckFormInsert(jsonData);
                    }
                }
            });
        }

    }


    function PlanFormInsert(jsonData) {
        var data = jsonData[1][0];

        // 총 시간
        var start_hour = (data.plan_start_time).substr(0, 16);
        var stop_hour = (data.plan_stop_time).substr(0, 16)
        var work_time = 0;

        if (start_hour.length > 0 && stop_hour.length > 0) {
            var start_time = new Date(start_hour);
            var stop_time = new Date(stop_hour);

            work_time = stop_time - start_time;
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_lunch && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_lunch) {
                work_time = work_time - 3600000;
            }
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_dinner && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_dinner) {
                work_time = work_time - 3600000;
            }

            var hour = Math.floor((work_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var min = Math.floor((work_time % (1000 * 60 * 60)) / (1000 * 60));
            if (work_time >= 86400000) {
                var day = parseInt(work_time / 86400000);

                hour = hour + (day * 24);
            }

            var hour_min = hour + "시간 " + min + "분";
            $("#PackingOrderLedger_Plan_Form input#work_time").val(hour_min);
        }

        // 생산시간
        $("form#PackingOrderLedger_Plan_Form input#start_time").val(start_hour);
        $("form#PackingOrderLedger_Plan_Form input#stop_time").val(stop_hour);


        // 시간당, 초당 생산량
        //$("form#PackingOrderLedger_Plan_Form input#UPH_qty").val(Number_Format((data.plan_UPH_qty).toFixed(3)));
        //$("form#PackingOrderLedger_Plan_Form input#UPS_qty").val(Number_Format((data.plan_UPS_qty).toFixed(3)));

        $("form#PackingOrderLedger_Plan_Form input#UPH_qty").val((data.plan_UPH_qty).toFixed(2));
        $("form#PackingOrderLedger_Plan_Form input#UPS_qty").val((data.plan_UPS_qty).toFixed(2));

        // 투입인원
        //$("form#PackingOrderLedger_Plan_Form input#worker_qty").val(Number_Format((data.plan_worker_qty).toFixed(3)));
        $("form#PackingOrderLedger_Plan_Form input#worker_qty").val((data.plan_worker_qty));

        // MEN
        //$("form#PackingOrderLedger_Plan_Form input#MAN_qty").val(Number_Format((data.plan_MEN).toFixed(3)));
        $("form#PackingOrderLedger_Plan_Form input#MAN_qty").val((data.plan_MEN).toFixed(2));

        // 관리자
        $("form#PackingOrderLedger_Plan_Form input#plan_emp_cd").val(data.plan_emp_cd);
        $("form#PackingOrderLedger_Plan_Form input#plan_emp_nm").val(data.emp_nm);
        $("form#PackingOrderLedger_Plan_Form input#plan_emp_post_nm").val(data.emp_post_nm);
    }


    function CheckFormInsert(jsonData) {
        var data = jsonData[1][0];
        // 생산수량
        //$("form#PackingOrderLedger_Check_Form input#goal_qty").val(Number_Format((data.check_goal_qty).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#goal_qty").val(Number_Format(Number_Change((data.check_goal_qty), 0)));

        // 진행율
        //$("form#PackingOrderLedger_Check_Form input#progress_rate").val(Number_Format((data.check_progress_rate).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#progress_rate").val(Number_Format(Number_Change((data.check_progress_rate), 2) + " %"));

        // 시간당, 초당 생산량
        //$("form#PackingOrderLedger_Check_Form input#UPH_qty").val(Number_Format((data.check_UPH_qty).toFixed(3)));
        //$("form#PackingOrderLedger_Check_Form input#UPS_qty").val(Number_Format((data.check_UPS_qty).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#UPH_qty").val(Number_Format(Number_Change((data.check_UPH_qty), 2)));
        $("form#PackingOrderLedger_Check_Form input#UPS_qty").val(Number_Format(Number_Change((data.check_UPS_qty), 2)));

        // 양품
        //$("form#PackingOrderLedger_Check_Form input#gd_rate").val(Number_Format((data.check_OK_rate).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#gd_rate").val(Number_Format(Number_Change((data.check_OK_rate), 2) + " %"));

        // 불량율
        //$("form#PackingOrderLedger_Check_Form input#defect_qty").val(Number_Format((data.check_defect_qty).toFixed(3)));
        //$("form#PackingOrderLedger_Check_Form input#defect_rate").val(Number_Format((data.check_defect_rate).toFixed(3)));

        $("form#PackingOrderLedger_Check_Form input#defect_qty").val(Number_Format(Number_Change((data.check_defect_qty), 0)));
        $("form#PackingOrderLedger_Check_Form input#defect_rate").val(Number_Format(Number_Change((data.check_defect_rate), 2) + " %"));

        // 총 시간
        var start_hour = data.result_start_time == 0 ? "" : (data.check_start_time).substr(0, 16);
        var stop_hour = data.result_stop_time == 0 ? "" : (data.check_stop_time).substr(0, 16);
        var work_time = 0;

        if (start_hour.length > 0 && stop_hour.length > 0) {
            var start_time = new Date(start_hour);
            var stop_time = new Date(stop_hour);

            work_time = stop_time - start_time;
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_lunch && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_lunch) {
                work_time = work_time - 3600000;
            }
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_dinner && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_dinner) {
                work_time = work_time - 3600000;
            }

            var hour = Math.floor((work_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var min = Math.floor((work_time % (1000 * 60 * 60)) / (1000 * 60));
            if (work_time >= 86400000) {
                var day = parseInt(work_time / 86400000);

                hour = hour + (day * 24);
            }

            var hour_min = hour + "시간 " + min + "분";
            $("#PackingOrderLedger_Check_Form input#work_time").val(hour_min);
        }

        // 생산시간
        $("form#PackingOrderLedger_Check_Form input#start_time").val(start_hour);
        $("form#PackingOrderLedger_Check_Form input#stop_time").val(stop_hour);


        // 평균중량
        //$("form#PackingOrderLedger_Check_Form input#item_content_avg").val(Number_Format((data.check_item_content_avg).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#item_content_avg").val(Number_Format(Number_Change((data.check_item_content_avg), 2)));

        // 펴준편차
        //$("form#PackingOrderLedger_Check_Form input#item_error_range").val(Number_Format((data.check_item_error_range).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#item_error_range").val(Number_Format(Number_Change((data.check_item_error_range), 2)));


        // 투입인원
        //$("form#PackingOrderLedger_Check_Form input#worker_qty").val(Number_Format((data.check_worker_qty).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#worker_qty").val(Number_Format(Number_Change((data.check_worker_qty), 0)));

        // MEN
        //$("form#PackingOrderLedger_Check_Form input#MAN_qty").val(Number_Format((data.check_MEN).toFixed(3)));
        $("form#PackingOrderLedger_Check_Form input#MAN_qty").val(Number_Format(Number_Change((data.check_MEN), 2)));

        // 비고
        $("form#PackingOrderLedger_Check_Form input#remark").val(data.check_remark);

        $("form#PackingOrderLedger_Check_Form input#insert_time").val(data.check_insert_time);
    }


    function ResultFormInsert(jsonData, gridData) {
        var data = jsonData[1][0];

        // 총 시간
        var start_hour = data.result_start_time == 0 ? "" : (data.result_start_time).substr(0, 16);
        var stop_hour = data.result_stop_time == 0 ? "" : (data.result_stop_time).substr(0, 16);
        var work_time = 0;

        if (stop_hour == "") {
            $("#PackingOrderLedger_Result_Form input#time_check").val("Y");
        } else {
            $("#PackingOrderLedger_Result_Form input#time_check").val("N");
        }

        $("form#PackingOrderLedger_Result_Form input#start_datetime").val((start_hour));
        $("form#PackingOrderLedger_Result_Form input#stop_datetime").val((stop_hour));

        stop_hour = stop_hour == "" ? getFormatDate(new Date()).substr(0, 16) : stop_hour;

        if (start_hour.length > 0 && stop_hour.length > 0) {
            var start_time = new Date(start_hour);
            var stop_time = new Date(stop_hour);

            work_time = stop_time - start_time;
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_lunch && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_lunch) {
                work_time = work_time - 3600000;
            }
            if (parseInt(start_hour.substr(11, 2)) <= PackingOrderLedger2_dinner && parseInt(stop_hour.substr(11, 2)) > PackingOrderLedger2_dinner) {
                work_time = work_time - 3600000;
            }

            var hour = Math.floor((work_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var min = Math.floor((work_time % (1000 * 60 * 60)) / (1000 * 60));
            if (work_time >= 86400000) {
                var day = parseInt(work_time / 86400000);

                hour = hour + (day * 24);
            }

            var hour_min = hour + "시간 " + min + "분";
            $("#PackingOrderLedger_Result_Form input#work_time").val(hour_min);
        }





        //// 총 시간
        //$("form#PackingOrderLedger_Result_Form input#start_datetime").val((data.result_start_time));
        //$("form#PackingOrderLedger_Result_Form input#stop_datetime").val((data.result_stop_time));
        //var start_hour = new Date(data.result_start_time).getHours();
        //var stop_hour = new Date(data.result_stop_time).getHours();
        //var work_time;

        //var temp_stop;
        //if (stop_hour == 0) {
        //    $("#PackingOrderLedger_Result_Form input#time_check").val("Y");
        //    temp_stop = new Date().getHours();
        //} else {
        //    $("#PackingOrderLedger_Result_Form input#time_check").val("N");
        //    temp_stop = stop_hour;
        //}

        //if (start_hour > 0 && temp_stop > 0) {
        //    var temp_start = start_hour;
        //    if (start_hour <= 12 && temp_stop > 12) {
        //        temp_start = temp_start + 1;
        //    }

        //    if (start_hour <= 18 && temp_stop > 18) {
        //        temp_start = temp_start + 1;
        //    }


        //    if (temp_start < temp_stop) {
        //        work_time = temp_stop - temp_start;
        //        $("#PackingOrderLedger_Result_Form input#work_time").val(work_time + "HR");
        //    }
        //}

        // 생산시간
        $("form#PackingOrderLedger_Result_Form input#start_time").val(start_hour);
        $("form#PackingOrderLedger_Result_Form input#stop_time").val(stop_hour);


        // 투입인원
        //$("form#PackingOrderLedger_Result_Form input#worker_qty").val(Number_Format((data.result_worker_qty).toFixed(3)));
        $("form#PackingOrderLedger_Result_Form input#worker_qty").val((data.result_worker_qty));

        if (data.result_update_time == null) {
            console.log("tes111");
            //if (jsonData[2].length <= 0 || jsonData[3].length <= 0) return;
            if (jsonData[2] == null || jsonData[3].length <= 0) return;

            var equip_data1 = jsonData[2][0];
            var equip_data2 = jsonData[3][0];

            var goal_qty = equip_data1.EQW_CNT_OK_APD;

            // 생산수량
            $("form#PackingOrderLedger_Result_Form input#goal_qty").val(Number_Format(Number_Change(goal_qty, 0)));

            // 진행율
            $("form#PackingOrderLedger_Result_Form input#progress_rate").val(((goal_qty / gridData.order_qty) * 100).toFixed(2) + " %");


            // 시간당, 초당 생산량
            var hour = Math.floor((work_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var sec = work_time / 1000;
            $("form#PackingOrderLedger_Result_Form input#UPH_qty").val(Number_Format(Number_Change((goal_qty / hour), 2)));
            $("form#PackingOrderLedger_Result_Form input#UPS_qty").val(Number_Format(Number_Change((goal_qty / sec), 2)));

            // 양품율
            $("form#PackingOrderLedger_Result_Form input#gd_rate").val(Number_Format(Number_Change((goal_qty / equip_data1.EQW_CNT_TOT) * 100, 2)) + " %");

            // 불량율
            $("form#PackingOrderLedger_Result_Form input#defect_qty").val((equip_data1.EQW_CNT_NG_APD));
            $("form#PackingOrderLedger_Result_Form input#defect_rate").val(Number_Format(Number_Change((equip_data1.EQW_CNT_NG_APD / equip_data1.EQW_CNT_TOT) * 100, 2)) + " %");

            // 평균중량
            $("form#PackingOrderLedger_Result_Form input#item_content_avg").val(Number_Format(Number_Change(equip_data2.weight_avg, 2)));

            // 펴준편차
            console.log(equip_data2);
            $("form#PackingOrderLedger_Result_Form input#item_error_range").val(Number_Format(Number_Change(equip_data2.weight_stde, 2)));


            // MEN
            $("form#PackingOrderLedger_Result_Form input#MAN_qty").val(Number_Format(Number_Change(goal_qty / data.result_worker_qty, 2)));


        } else {
            // 생산수량
            $("form#PackingOrderLedger_Result_Form input#goal_qty").val(Number_Format(Number_Change(data.result_goal_qty, 0)));

            // 진행율
            $("form#PackingOrderLedger_Result_Form input#progress_rate").val(Number_Format(Number_Change(data.result_progress_rate, 2) + " %"));

            // 시간당, 초당 생산량
            $("form#PackingOrderLedger_Result_Form input#UPH_qty").val(Number_Format(Number_Change(data.result_UPH_qty, 2)));
            $("form#PackingOrderLedger_Result_Form input#UPS_qty").val(Number_Format(Number_Change(data.result_UPS_qty, 2)));

            // 양품
            $("form#PackingOrderLedger_Result_Form input#gd_rate").val(Number_Format(Number_Change(data.result_OK_rate, 2) + " %"));

            // 불량율
            //$("form#PackingOrderLedger_Result_Form input#defect_qty").val(Number_Format((data.result_defect_qty).toFixed(3)));
            //$("form#PackingOrderLedger_Result_Form input#defect_rate").val(Number_Format((data.result_defect_rate).toFixed(3)));
            $("form#PackingOrderLedger_Result_Form input#defect_qty").val(Number_Format(Number_Change(data.result_defect_qty, 0)));
            $("form#PackingOrderLedger_Result_Form input#defect_rate").val(Number_Format(Number_Change(data.result_defect_rate, 2) + " %"));


            // 평균중량
            //$("form#PackingOrderLedger_Result_Form input#item_content_avg").val(Number_Format((data.result_item_content_avg).toFixed(3)));
            $("form#PackingOrderLedger_Result_Form input#item_content_avg").val(Number_Format(Number_Change(data.result_item_content_avg, 2)));


            // 펴준편차
            //$("form#PackingOrderLedger_Result_Form input#item_error_range").val(Number_Format((data.result_item_error_range).toFixed(3)));
            $("form#PackingOrderLedger_Result_Form input#item_error_range").val(Number_Format(Number_Change(data.result_item_error_range, 2)));


            // MEN
            //$("form#PackingOrderLedger_Result_Form input#MAN_qty").val(Number_Format((data.result_MEN).toFixed(3)));
            $("form#PackingOrderLedger_Result_Form input#MAN_qty").val(Number_Format(Number_Change(data.result_MEN, 2)));
        }



       

    }


    function PlanEmp_Search() {
        var popup = $("#PackingOrderLedger_Plan_Popup_EmpPopup").dxPopup("instance");

        popup.show();
    }



    // 검색용 팝업 제품 로우 더블클릭
    function PackingOrderLedger_Plan_Popup_EmpRowDblClick(selectedItems) {
        var data = selectedItems.data;

        $("#PackingOrderLedger_Plan_Popup_Form input#plan_emp_nm").val(data.emp_nm);
        $("#PackingOrderLedger_Plan_Popup_Form input#plan_emp_post_nm").val(data.emp_post_nm);
        $("#PackingOrderLedger_Plan_Popup_Form input#plan_emp_cd").val(data.emp_cd);

        var popup = $("#PackingOrderLedger_Plan_Popup_EmpPopup").dxPopup("instance");

        popup.hide();
    }


    function PackingOrderLedger_Plan_Add() {
        var formData = new FormData($("#PackingOrderLedger_Plan_Popup_Form")[0]);
        var grid = $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance");
        var data = getGridRowByKey("PackingOrderLedgerGrid_Tab_1", grid.option("focusedRowKey"));

        //formData.set("worker_qty", formData.get("worker_qty").substr(0, formData.get("worker_qty").length - 3).replace(/(^0+)/, ""));

        formData.set("packing_order_no", data.order_no);
        formData.set("start_hour", formData.get("start_hour").length == 0 ? 0 : getFormatDate(new Date(formData.get("start_hour"))));
        formData.set("stop_hour", formData.get("stop_hour").length == 0 ? 0 : getFormatDate(new Date(formData.get("stop_hour"))));

        formData.set("UPH_qty", formData.get("UPH_qty").replace(/,/g, ""));
        formData.set("UPS_qty", formData.get("UPS_qty").replace(/,/g, ""));;
        formData.set("MAN_qty", formData.get("MAN_qty").replace(/,/g, ""));


        $.ajax({
            type: 'POST',
            url: '/PackingManage/PackingOrderLedger_Plan_Add',
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                var popup = $("#PackingOrderLedger_Plan_subContentPopup").dxPopup("instance");
                popup.hide();

                PackingOrderLedger2RowSelect();
            }
        });
    }


    function PackingOrderLedger_Check_Add() {
        var formData = new FormData($("#PackingOrderLedger_Check_Popup_Form")[0]);
        var grid = $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance");
        var data = getGridRowByKey("PackingOrderLedgerGrid_Tab_1", grid.option("focusedRowKey"));

        formData.set("packing_order_no", data.order_no);
        formData.set("start_time", formData.get("start_hour").length == 0 ? 0 : getFormatDate(new Date(formData.get("start_hour"))));
        formData.set("stop_time", formData.get("stop_hour").length == 0 ? 0 : getFormatDate(new Date(formData.get("stop_hour"))));

        var url;
        if (formData.get("check_yn") == "N") {
            url = '/PackingManage/PackingOrderLedger_Result_Add';
        } else {
            if (!confirm("수동 실적을 입력하시겠습니까?")) {
                return;
            }

            formData.set("progress_rate", formData.get("progress_rate").substr(0, formData.get("progress_rate").length - 2));
            formData.set("gd_rate", formData.get("gd_rate").substr(0, formData.get("gd_rate").length - 2));
            formData.set("defect_rate", formData.get("defect_rate").substr(0, formData.get("defect_rate").length - 2));

            formData.set("goal_qty", formData.get("goal_qty").replace(/,/g, ""));
            formData.set("progress_rate", formData.get("progress_rate").replace(/,/g, ""));
            formData.set("UPH_qty", formData.get("UPH_qty").replace(/,/g, ""));
            formData.set("UPS_qty", formData.get("UPS_qty").replace(/,/g, ""));
            formData.set("item_content_avg", formData.get("item_content_avg").replace(/,/g, ""));
            formData.set("item_error_range", formData.get("item_error_range").replace(/,/g, ""));
            formData.set("worker_qty", formData.get("worker_qty").replace(/,/g, ""));
            formData.set("MAN_qty", formData.get("MAN_qty").replace(/,/g, ""));

            url = '/PackingManage/PackingOrderLedger_Check_Add';

        }

        $.ajax({
            type: 'POST',
            url: url,
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                var popup = $("#PackingOrderLedger_Check_subContentPopup").dxPopup("instance");
                popup.hide();

                PackingOrderLedger2RowSelect();
            }
        });
    }


    function PackingOrderLedger_Check_Total() {
        var formData = new FormData($("#PackingOrderLedger_Result_Form")[0]);
        if (confirm(formData.get("start_datetime") + " 부터 \n" + formData.get("stop_datetime") + " 까지의 데이터를 집계합니다")) {

            var grid = $("#PackingOrderLedgerGrid_Tab_1").dxDataGrid("instance");
            var data = getGridRowByKey("PackingOrderLedgerGrid_Tab_1", grid.option("focusedRowKey"));

            $.ajax({
                type: 'POST',
                url: '/PackingManage/PackingOrderLedger_Check_Total',
                data: {
                    start_time: formData.get("start_datetime"),
                    stop_time: formData.get("stop_datetime"),
                    packing_order_no: data.order_no
                },
                success: function (result) {
                    var jsonData = JSON.parse(result);

                    alert(jsonData.messege);

                    var popup = $("#PackingOrderLedger_Check_subContentPopup").dxPopup("instance");
                    popup.hide();
                }
            });
        }

    }


    function Number_Format(number) {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }


    function Number_Change(number1, number2) {

        if (number2 == 0) {
            var result = Math.floor(number1);

            return result;
        } else {
            var count = Math.pow(10, number2);
            var num = Math.floor(number1 * count) / count;
            var result = num.toFixed(number2)// 0을 채워주기 toFixed를 이용

            return result;
        }
    }

    function getFormatDate(date) {
        var year = date.getFullYear();              //yyyy
        var month = (1 + date.getMonth());          //M
        month = month >= 10 ? month : '0' + month;  //month 두자리로 저장

        var day = date.getDate();                   //d
        day = day >= 10 ? day : '0' + day;          //day 두자리로 저장

        var hour = date.getHours();
        hour = hour >= 10 ? hour : '0' + hour;

        var min = date.getMinutes();
        min = min >= 10 ? min : '0' + min;

        var sec = date.getSeconds();
        sec = sec >= 10 ? sec : '0' + sec;

        return year + '-' + month + '-' + day + " " + hour + ":" + min + ":" + sec;       //'-' 추가하여 yyyy-mm-dd 형태 생성 가능
    }

</script>


<div id="PackingOrderLedger2">
    <div id="PackingOrderLedger2ItemPopup"></div>

    <div>
        @(Html.DevExtreme().Popup()
            .ID("PackingOrderLedgerItemPopup2")
            .Width(1200)
            .Height(700)
            .ShowTitle(true)
            .Title("포장제품 조회")
            .Visible(false)
            .DragEnabled(false)
            .ContentTemplate(new TemplateName("popup-template"))
        )
    </div>

    <div>
        @(Html.DevExtreme().Popup()
            .ID("PackingOrderLedgerOrderPopup")
            .Width(900)
            .Height(700)
            .ShowTitle(true)
            .Title("제조지시 조회")
            .Visible(false)
            .DragEnabled(false)
            .ContentTemplate(new TemplateName("popup-template"))
        )
    </div>

    @using (Html.DevExtreme().NamedTemplate("PackingOrderLedger2SignPopupTemplate"))
    {
        <h6>전자서명은 수기서명과 동일한 효력을 갖습니다.</h6>

        <form id="PackingOrderLedger2Sign_Form">

            <div class="input-wrapper">
                <label class="col-3">아이디</label>
                <input type="text" class="col-8 form-control" name="txt_ID">

                <label class="col-3">비밀번호</label>
                <input type="password" class="col-8 form-control" name="txt_Pass">
            </div>

        </form>
        <div class="align-content-end">
            <button onclick="PackingOrderLedger2SignSubmit()">확인</button>
        </div>

        <br />
        <hr />

        <form id="PackingOrderLedger2SignConfirmForm">

            <label class="col-3">부서</label>
            <input type="text" class="col-8 form-control" name="dept_nm" readonly="readonly" />
            <label class="col-3">성명</label>
            <input type="text" class="col-8 form-control" name="emp_nm" readonly="readonly" />

        </form>

    }

    @(Html.DevExtreme().Popup()
        .ID("PackingOrderLedger2SignPopup")
        .Width(500)
        .Height(420)
        .ShowTitle(true)
        .Title("작업자 인증")
        .OnHidden("clearPackingOrderLedger2SignInput")
        .Visible(false)
        .DragEnabled(true)
        .CloseOnOutsideClick(false)
    )
    @* === 생산계획 정보 입력 팝업 === *@
    @(Html.DevExtreme().Popup()
        .ID("PackingOrderLedger_Plan_subContentPopup")
        .Width(650)
        .Height(320)
        .ShowTitle(true)
        .Title("생산 계획 입력")
        .Visible(false)
        .DragEnabled(true)
        .CloseOnOutsideClick(false)
        .OnHiding("PackingOrderLedger_Plan_Popup_clear")
    )

    @using (Html.DevExtreme().NamedTemplate("PackingOrderLedger_Plan_subContentPopup_Template"))
    {
        <div id="PackingOrderLedger_Plan_Popup_EmpPopup"></div>

        <form id="PackingOrderLedger_Plan_Popup_Form" style="padding: 5px 0;">
            <div class="input-wrapper">
                <label class="col-2">목표수량</label>
                <div class="input-group col-4">
                    <input type="text" class="form-control col-8" id="order_qty" readonly>
                    <input type="text" class="form-control col-4" id="item_packunit" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2"></label>
                <div class="input-group col-4">
                    <input type="text" class="form-control col-8" name="UPH_qty" id="UPH_qty" readonly>
                    <input type="text" class="form-control col-4" name="qty_HR" id="qty_HR" readonly>
                </div>
                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" name="UPS_qty" id="UPS_qty" readonly>
                    <input type="text" class="form-control col-4" name="qty_SEC" id="qty_SEC" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">생산시간</label>
                <div class="input-group col-8">
                    <input type="text" class="form-control datetime_mask col-4" name="start_hour" id="start_hour" onchange="WorkTime_Insert('1')">
                    <input type="text" class="form-control col-1" value="~" readonly>
                    <input type="text" class="form-control datetime_mask col-4" name="stop_hour" id="stop_hour" onchange="WorkTime_Insert('2')">
                    <input type="text" class="form-control col-3" id="work_time" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">중량</label>
                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" id="item_content" step="0.01" readonly>
                    <input type="text" class="form-control col-4" id="item_content_unit" readonly>
                </div>

                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" id="item_error_range" name="item_error_range" readonly>
                    <input type="text" class="form-control col-4" value="±" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">투입인원</label>
                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" name="worker_qty" id="worker_qty" onchange="MAN_Insert('0')">
                    <input type="text" class="form-control col-4" value="명" readonly>
                </div>

                <div class="input-group col-4">
                    <input type="text" class="form-control col-8" name="MAN_qty" id="MAN_qty" readonly>
                    <input type="text" class="form-control col-4" value="MAN" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">관리자</label>
                <div class="input-group col-4">
                    <input type="text" class="form-control col-6" id="plan_emp_nm" readonly>
                    <input type="hidden" name="plan_emp_cd" id="plan_emp_cd" readonly>
                    <input type="text" class="form-control col-5" id="plan_emp_post_nm" readonly>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="plan_emp_cd_btn" onclick="PlanEmp_Search()">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>

        </form>

        <div>
            @(Html.DevExtreme().Toolbar()
                .ID("PackingOrderLedger_Plan_subContentPopup_Toolbar")
                .Items(items =>
                {
                    items.Add()
                        .Widget(w => w
                        .Button()
                        .Type(ButtonType.Default)
                        .StylingMode(ButtonStylingMode.Contained)
                        .ID("PackingOrderLedger_Plan_subContentPopup_Add")
                        .Icon("save")
                        .Text("저장")
                        .OnClick("PackingOrderLedger_Plan_Add")
                        )
                        .Location(ToolbarItemLocation.After);
                })
            )
        </div>
    }


    @* === 생산실적 정보 입력 팝업 === *@
    @(Html.DevExtreme().Popup()
        .ID("PackingOrderLedger_Check_subContentPopup")
        .Width(650)
        .Height(320)
        .ShowTitle(true)
        .Title("생산 실적 입력")
        .Visible(false)
        .DragEnabled(true)
        .CloseOnOutsideClick(false)
        .OnHiding("PackingOrderLedger_Check_Popup_clear")
    )

    @using (Html.DevExtreme().NamedTemplate("PackingOrderLedger_Check_subContentPopup_Template"))
    {
        <div id="PackingOrderLedger_Check_Popup_EmpPopup"></div>

        <form id="PackingOrderLedger_Check_Popup_Form" style="padding: 5px 0;">
            <input type="hidden" name="check_yn" id="check_yn" value="N" />

            <div class="input-wrapper">
                <label class="col-2">생산수량</label>
                <div class="input-group col-3">
                    <input type="text" class="form-control col-7" name="goal_qty" id="goal_qty" onchange="GoalQty_Change();" readonly>
                    <input type="text" class="form-control col-5" name="item_packunit" id="item_packunit" readonly>
                </div>

                <label class="col-2">진행율</label>
                <div class="input-group col-3">
                    <input type="text" class="form-control" name="progress_rate" id="progress_rate" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2"></label>
                <div class="input-group col-4">
                    <input type="text" class="form-control col-8" name="UPH_qty" id="UPH_qty" readonly>
                    <input type="text" class="form-control col-4" name="qty_HR" id="qty_HR" readonly>
                </div>

                <div class="input-group col-4">
                    <input type="text" class="form-control col-8" name="UPS_qty" id="UPS_qty" readonly>
                    <input type="text" class="form-control col-4" name="qty_SEC" id="qty_SEC" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">양품율</label>
                <div class="input-group col-3">
                    <input type="text" class="form-control" name="gd_rate" id="gd_rate" readonly>
                </div>

                <label class="col-2">불량율</label>
                <div class="input-group col-3">
                    <input type="text" class="form-control col-6" name="defect_qty" id="defect_qty" onchange="DefectQty_Chagne();" readonly>
                    <input type="text" class="form-control col-6" name="defect_rate" id="defect_rate" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">생산시간</label>
                <div class="input-group col-8">
                    <input type="text" class="form-control datetime_mask col-4" name="start_hour" id="start_hour" onchange="WorkTime_Insert('3')">
                    <input type="text" class="form-control col-1" value="~" readonly>
                    <input type="text" class="form-control datetime_mask col-4" name="stop_hour" id="stop_hour" onchange="WorkTime_Insert('4')">
                    <input type="text" class="form-control col-3" id="work_time" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">평균중량</label>
                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" name="item_content_avg" id="item_content_avg" step="0.01" readonly>
                    <input type="text" class="form-control col-4" name="item_content_unit" id="item_content_unit" readonly>
                </div>

                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" id="item_error_range" name="item_error_range" readonly>
                    <input type="text" class="form-control col-4" value="±" readonly>
                </div>
            </div>

            <div class="input-wrapper">
                <label class="col-2">투입인원</label>
                <div class="input-group col-4">
                    <input type="number" class="form-control col-8" name="worker_qty" id="worker_qty" onchange="MAN_Insert('1')" readonly />
                    <input type="text" class="form-control col-4" value="명" readonly>
                </div>

                <div class="input-group col-4">
                    <input type="text" class="form-control col-8" name="MAN_qty" id="MAN_qty" readonly>
                    <input type="text" class="form-control col-4" value="MAN" readonly>
                </div>
            </div>

            <div class="input-wrapper display-none">
                <label class="col-2">비고</label>
                <div class="input-group col-8">
                    <textarea id="check_remark" name="check_remark" class="form-control" cols="100" rows="5" style="height: 50px;"></textarea>
                </div>
            </div>
        </form>


        <div>
            @(Html.DevExtreme().Toolbar()
                .ID("PackingOrderLedger_Check_subContentPopup_Toolbar")
                .Items(items =>
                {
                    items.Add()
                        .Widget(w => w
                        .Button()
                        .Type(ButtonType.Default)
                        .StylingMode(ButtonStylingMode.Contained)
                        .ID("PackingOrderLedger_Check_subContentPopup_Add")
                        .Icon("save")
                        .Text("저장")
                        .OnClick("PackingOrderLedger_Check_Add")
                    )
                    .Location(ToolbarItemLocation.After);
                })
                .Items(items =>
                {
                    items.Add()
                        .Widget(w => w
                        .Button()
                        .Type(ButtonType.Default)
                        .StylingMode(ButtonStylingMode.Contained)
                        .ID("PackingOrderLedger_Check_subContentPopup_Total")
                        .Icon("movetofolder")
                        .Text("집계")
                        .OnClick("PackingOrderLedger_Check_Total")
                    )
                    .Location(ToolbarItemLocation.After);
                })
            )
        </div>
    }




    <div class="mainTop row">

        <div class="col-8">

            <form id="PackingOrderLedger2SearchForm">

                <div class="input-wrapper">

                    <div class="input-group input-group-sm col-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">지시일자</span>
                        </div>
                        <input type="text" class="form-control datepicker" name="SearchDate" id="PackingOrderLedger2DatePicker1" value="@DateTime.Today.AddDays(-(DateTime.Today.Day-1)).ToShortDateString()">
                        <input type="text" class="form-control datepicker" name="SearchEndDate" id="PackingOrderLedger2DatePicker2" value="@DateTime.Today.ToShortDateString()">
                    </div>

                    <div class="input-group input-group-sm col-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">구분</span>
                        </div>
                        <select class="form-control" name="MakingDeptCd" id="PackingOrderLedger2Dept">
                            @foreach (DataRow row in ((DataTable)Public_Function.GetMaster("공통코드", "S", "MD001")).Rows)
                            {
                                <option value="@row["keyfield"]">@row["displayfield"]</option>
                            }
                        </select>
                    </div>

                    <div class="input-group input-group-sm col-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">상태</span>
                        </div>
                        <select class="form-control" name="MakingDeptCd2" id="PackingOrderLedger2State">
                            @foreach (DataRow row in ((DataTable)Public_Function.GetMaster("공통코드", "S", "CM091")).Rows)
                            {
                                <option value="@row["keyfield"]">@row["displayfield"]</option>
                            }
                        </select>
                    </div>

                    <div class="input-group input-group-sm col-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">제품</span>
                        </div>
                        <input type="text" class="form-control" name="ItemCd" id="PackingOrderLedger2ItemCode">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" onclick="PackingOrderLedger2SearchItem()">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>

                </div>

            </form>

        </div>


        <div class="CRUD-btn col-4">
            @* === CRUD 버튼 === *@
            @{Html.SetToolbar(0, true, "Search;Input;Edit;Delete;Save;Undo"); }
        </div>

    </div>

    <div class="row">
        <div class="col-3 pr-1" style="height: 871px;">
            <div class="box mb-0">
                @(Html.DevExtreme().DataGrid()
                .ID("PackingOrderLedger2Grid_1")
                .ShowBorders(true)
                .ShowColumnLines(true)
                .ColumnAutoWidth(true)
                .FocusedRowEnabled(true)
                .Scrolling(scrolling => scrolling.Mode(GridScrollingMode.Virtual))
                .Height(869)
                .FocusedRowIndex(0)
                .KeyExpr("order_id")
                .Selection(s => s.Mode(SelectionMode.Single))
                .Columns(columns =>
                {
                    columns.Add().DataField("order_date").Caption("지시일자");
                    columns.Add().DataField("making_dept_nm").Caption("구분");
                    columns.Add().DataField("sign_status_nm").Caption("상태");
                    columns.Add().DataField("work_order_cnt").Caption("포장지시수");
                    columns.Add().DataField("item_nm").Caption("제품명");
                })
                .OnFocusedRowChanged("PackingOrderLedger2SelectPackingOrder")
            )
            </div>
        </div>

        <div class="col-9 pl-0">
            <div>

                <div class="box-height-auto mb-1" style="width:100%">

                    <div class="divName">
                        <p>포장지시대장</p>
                    </div>

                    <form id="PackingOrderLedger2Form" style="padding: 25px 0;">

                        <div class="input-wrapper">
                            <label class="col-1">지시일자</label>
                            <div class="input-group col-3">
                                <input type="text" class="form-control col-12 required" name="order_start" id="PackingOrderLedger2DatePicker3" value="@DateTime.Today.ToShortDateString()">
                            </div>

                            <label class="col-1">구분 <star>*</star></label>
                            <div class="input-group col-3">
                                <select class="form-control required" name="order_dept_2" id="PackingOrderLedger2Dept_2">
                                    @foreach (DataRow row in ((DataTable)Public_Function.GetMaster("공통코드", "P", "MD001")).Rows)
                                    {
                                        <option value="@row["keyfield"]">@row["displayfield"]</option>
                                    }
                                </select>
                            </div>
                        </div>

                        <!-- visible(false)-->
                        <select class="col-1 form-control" name="order_dept_1" id="PackingOrderLedger2Dept_1" style="display:none;">
                            @foreach (DataRow row in ((DataTable)Public_Function.GetMaster("공통코드", "P", "MD003")).Rows)
                            {
                                <option value="@row["keyfield"]">@row["displayfield"]</option>
                            }
                        </select>

                    </form>

                </div>


                <div class="box-height-auto mb-1" style="height: 537px;">

                    <!-- DevExtreme Tab -->
                    <div id="PackingOrderLedger2_Tab_div">
                        @(Html.DevExtreme().Tabs()
                        .ID("PackingOrderLedger2_Tab_gap")
                        .DataSource(tabs)
                        .SelectedIndex(0)
                        .OnItemClick("Tabs_itemClick")
                    )
                    </div>

                    <div id="PackingOrderLedger2Tab_1">

                        <!-- 포장지시대장작성 -->
                        @(Html.DevExtreme().DataGrid()
                            .ID("PackingOrderLedgerGrid_Tab_1")
                            .KeyExpr("order_no")
                            //.OnInitNewRow("PackingOrderLedger2InitNew")
                            .AllowColumnResizing(true)
                            .ShowBorders(true)
                            .ShowColumnLines(true)
                            .ColumnAutoWidth(true)
                            .DataSource(new JS("setPackingOrderData"))
                            .Selection(s => s.Mode(SelectionMode.Single))
                            .Columns(columns =>
                            {
                                columns.Add().DataField("order_no").Caption("포장지시번호");
                                columns.Add().DataField("order_qty").DataType(GridColumnDataType.Number).Caption("지시수량");
                                columns.Add().DataField("item_cd").Caption("제품코드").CellTemplate(new JS("PackingOrderLedger2CellWithButton")).Width(220)
                                    .ValidationRules(vr =>
                                    {
                                        vr.AddRequired().Message("제품코드는 필수 입력사항입니다.");
                                    });
                                columns.Add().DataField("item_nm").Caption("제품명");
                                columns.Add().DataField("lot_no").DataType(GridColumnDataType.String)
                                    .Caption("제조번호")
                                    .ValidationRules(vr =>
                                    {
                                        vr.AddRequired().Message("제조번호는 필수 입력사항입니다.");
                                    });
                                columns.Add().DataField("lot_date").DataType(GridColumnDataType.Date)
                                    .Caption("제조일자")
                                    .ValidationRules(vr =>
                                    {
                                        vr.AddRequired().Message("제조일자는 필수 입력사항입니다.");
                                    });
                                //columns.Add().DataField("valid_date").DataType(GridColumnDataType.Date).Caption("사용기한");
                                columns.Add().DataField("order_bigo").DataType(GridColumnDataType.String).Caption("비고");
                                columns.Add().DataField("order_status_nm").Caption("상태");
                                columns.Add().DataField("order_batch_size").Visible(false);
                                columns.Add().DataField("order_no_M").Visible(false);
                                columns.Add().Caption("")
                                    .CellTemplate(new JS("PackingOrderLedgerCellWithButton"))
                                    .Alignment(HorizontalAlignment.Center)
                                    .Width("5%");
                            })
                            .OnRowUpdated("PackingOrderLedger2Update")
                            .OnRowInserted("PackingOrderLedger2Insert")
                            .OnRowRemoved("PackingOrderLedger2DeleteOrder")
                            .OnCellClick("PackingOrderLedger2CellClick")
                            .OnCellPrepared("PackingOrderEditableColumn")
                            .OnToolbarPreparing("HideToolbarButton")
                            .OnRowValidating("PackingOrderGridValidation")
                            .OnFocusedRowChanged("PackingOrderLedger2RowSelect")
                        )
                    </div>


                    <div class="display-none" id="PackingOrderLedger2Tab_2">
                        @(Html.DevExtreme().DataGrid()
                    .ID("PackingOrderLedger2Grid_Tab_2")
                    .ShowBorders(true)
                    .ShowColumnLines(true)
                    .Selection(s => s.Mode(SelectionMode.Single))
                    .Columns(columns =>
                    {
                        columns.Add().DataField("displayfield").Caption("구분");
                        columns.Add().DataField("sign_emp_nm").Caption("서명자");
                        columns.Add().DataField("sign_time").Width(185).Caption("서명일자");
                        columns.Add().DataField("sign_image").Caption("서명")
                            .AllowFiltering(false)
                            .AllowSorting(false)
                            .CellTemplate(@<text>
                                    <div>
                                        <img src="<%- value %>" alt="" style="width:80px; height:25px;"/>
                                    </div>
                                </text>);
                    })
                    .OnCellClick("PackingOrderLedger2Sign")
                )
                    </div>

                </div>
            </div>


            <div class="container-fluid">
                <div class="row">
                    <div class="col-4 pr-1 pl-0">
                        <div class="box">
                            <div class="divName">
                                <p>생산 계획</p>
                            </div>

                            <form id="PackingOrderLedger_Plan_Form" style="padding: 5px 0;">

                                <div class="input-wrapper">
                                    <label class="col-3">목표수량</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="order_qty" id="order_qty" readonly>
                                        <input type="text" class="form-control col-5" name="item_packunit" id="item_packunit" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3"></label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="UPH_qty" id="UPH_qty" readonly>
                                        <input type="text" class="form-control col-5" name="qty_HR" id="qty_HR" readonly>
                                    </div>

                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="UPS_qty" id="UPS_qty" readonly>
                                        <input type="text" class="form-control col-5" name="qty_SEC" id="qty_SEC" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">생산시간</label>
                                    <div class="input-group col-8">
                                        <input type="text" class="form-control col-4" id="start_time" name="start_time" readonly>
                                        <input type="text" class="form-control col-1" value="~" readonly>
                                        <input type="text" class="form-control col-4" id="stop_time" name="stop_time" readonly>
                                        <input type="text" class="form-control col-3" name="work_time" id="work_time" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">중량</label>
                                    <div class="input-group col-3">
                                        <input type="text" class="form-control col-6" name="item_content" id="item_content" step="0.01" readonly>
                                        <input type="text" class="form-control col-6" name="item_content_unit" id="item_content_unit" readonly>
                                    </div>

                                    <label class="col-2">편차</label>
                                    <div class="input-group col-3">
                                        <input type="text" class="form-control col-7" id="item_error_range" name="item_error_range" readonly>
                                        <input type="text" class="form-control col-5" value="±" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">투입인원</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-8" name="worker_qty" id="worker_qty" readonly>
                                        <input type="text" class="form-control col-4" value="명" readonly>
                                    </div>

                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-8" id="MAN_qty" readonly>
                                        <input type="text" class="form-control col-4" value="MAN" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">관리자</label>
                                    <div class="input-group col-4">
                                        <input type="hidden" id="plan_emp_cd" />
                                        <input type="text" class="form-control col-6" id="plan_emp_nm" readonly>
                                        <input type="text" class="form-control col-6" id="plan_emp_post_nm" readonly>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>


                    <div class="col-4 pr-1 pl-0">
                        <div class="box">
                            <div class="divName">
                                <p>생산 실적</p>
                            </div>

                            <form id="PackingOrderLedger_Result_Form" style="padding: 5px 0;">
                                <input type="hidden" name="time_check" id="time_check" value="N" />
                                <input type="hidden" name="start_datetime" id="start_datetime">
                                <input type="hidden" name="stop_datetime" id="stop_datetime">
                                <div class="input-wrapper">
                                    <label class="col-3">생산수량</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="goal_qty" id="goal_qty" value=0 readonly>
                                        <input type="text" class="form-control col-5" name="item_packunit" id="item_packunit" readonly>
                                    </div>

                                    <label class="col-2">진행율</label>
                                    <div class="input-group col-2">
                                        <input type="text" class="form-control" name="progress_rate" id="progress_rate" value=0.00 readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3"></label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="UPH_qty" id="UPH_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-5" name="qty_HR" id="qty_HR" readonly>
                                    </div>

                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="UPS_qty" id="UPS_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-5" name="qty_SEC" id="qty_SEC" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">양품율</label>
                                    <div class="input-group col-2">
                                        <input type="text" class="form-control" name="gd_rate" id="gd_rate" value=0.00 readonly>
                                    </div>

                                    <label class="col-2">불량율</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-4" name="defect_qty" id="defect_qty" value=0 readonly>
                                        <input type="text" class="form-control col-8" name="defect_rate" id="defect_rate" value=0.00 readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">생산시간</label>
                                    <div class="input-group col-8">
                                        <input type="text" class="form-control col-4" id="start_time" name="start_time" readonly>
                                        <input type="text" class="form-control col-1" value="~" readonly>
                                        <input type="text" class="form-control col-4" id="stop_time" name="stop_time" readonly>
                                        <input type="text" class="form-control col-3" name="work_time" id="work_time" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">평균중량</label>
                                    <div class="input-group col-3">
                                        <input type="text" class="form-control col-8" name="item_content_avg" id="item_content_avg" step="0.01" value=0.00 readonly>
                                        <input type="text" class="form-control col-4" name="item_content_unit" id="item_content_unit" readonly>
                                    </div>

                                    <label class="col-2" style="padding: 0px 2%;">표준편차</label>
                                    <div class="input-group col-3">
                                        <input type="text" class="form-control col-8" id="item_error_range" name="item_error_range" value=0.00 readonly>
                                        <input type="text" class="form-control col-4" value="±" readonly>
                                    </div>
                                </div>


                                <div class="input-wrapper">
                                    <label class="col-3">투입인원</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-8" name="worker_qty" id="worker_qty" value=0 readonly>
                                        <input type="text" class="form-control col-4" value="명" readonly>
                                    </div>

                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-8" id="MAN_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-4" value="MAN" readonly>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>


                    <div class="col-4 pr-0 pl-0">
                        <div class="box">
                            <div class="divName">
                                <p>수동 실적</p>
                            </div>

                            <form id="PackingOrderLedger_Check_Form" style="padding: 5px 0;">
                                <input type="hidden" id="remark" />
                                <input type="hidden" id="insert_time" />

                                <div class="input-wrapper">
                                    <label class="col-3">생산수량</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="goal_qty" id="goal_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-5" name="item_packunit" id="item_packunit" readonly>
                                    </div>

                                    <label class="col-2">진행율</label>
                                    <div class="input-group col-2">
                                        <input type="text" class="form-control" name="progress_rate" id="progress_rate" value=0.00 readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3"></label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="UPH_qty" id="UPH_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-5" name="qty_HR" id="qty_HR" readonly>
                                    </div>

                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-7" name="UPS_qty" id="UPS_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-5" name="qty_SEC" id="qty_SEC" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">양품율</label>
                                    <div class="input-group col-2">
                                        <input type="text" class="form-control" name="gd_rate" id="gd_rate" value=0.00 readonly>
                                    </div>

                                    <label class="col-2">불량율</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-4" name="defect_qty" id="defect_qty" value=0 readonly>
                                        <input type="text" class="form-control col-8" name="defect_rate" id="defect_rate" value=0.00 readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">생산시간</label>
                                    <input type="hidden" id="hidden_time" name="hidden_time" readonly>
                                    <div class="input-group col-8">
                                        <input type="text" class="form-control col-4" id="start_time" name="start_time" readonly>
                                        <input type="text" class="form-control col-1" value="~" readonly>
                                        <input type="text" class="form-control col-4" id="stop_time" name="stop_time" readonly>
                                        <input type="text" class="form-control col-3" name="work_time" id="work_time" readonly>
                                    </div>
                                </div>

                                <div class="input-wrapper">
                                    <label class="col-3">평균중량</label>
                                    <div class="input-group col-3">
                                        <input type="text" class="form-control col-8" name="item_content_avg" id="item_content_avg" step="0.01" value=0 readonly>
                                        <input type="text" class="form-control col-4" name="item_content_unit" id="item_content_unit" readonly>
                                    </div>

                                    <label class="col-2" style="padding: 0px 2%;">표준편차</label>
                                    <div class="input-group col-3">
                                        <input type="text" class="form-control col-8" id="item_error_range" name="item_error_range" value=0 readonly>
                                        <input type="text" class="form-control col-4" value="±" readonly>
                                    </div>
                                </div>


                                <div class="input-wrapper">
                                    <label class="col-3">투입인원</label>
                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-8" name="worker_qty" id="worker_qty" value=0 readonly>
                                        <input type="text" class="form-control col-4" value="명" readonly>
                                    </div>

                                    <div class="input-group col-4">
                                        <input type="text" class="form-control col-8" id="MAN_qty" value=0.00 readonly>
                                        <input type="text" class="form-control col-4" value="MAN" readonly>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>